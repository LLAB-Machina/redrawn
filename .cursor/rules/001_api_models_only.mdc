---
description: Enforce typed API models for all endpoint arguments and return values (no map[string]any or interface{} in handlers/services)
globs: api/internal/handlers/**/*,api/internal/services/**/*,api/internal/api/**/*,api/cmd/api/**/*
alwaysApply: true
---

**Typed API models only**

- **Do not** use `map[string]any`, `map[string]interface{}`, or `interface{}` in any handler/service function signatures or API response types.
- **Define request/response structs** in `api/internal/api/models.go` and use them across handlers and services.
- **PATCH semantics**: use pointer fields in request structs (e.g., `*string`) to indicate optional fields.
- **Background jobs/queues**: define explicit payload structs per job type and pass those through services. If the queue layer requires a generic format, convert at the queue boundary only (never expose generic maps at API layer).
- **Ent generated code** in `api/ent/**/*` may use generic map types; treat that as an internal detail and convert to/from typed models at service boundaries.
- If truly free-form JSON is unavoidable, prefer a dedicated typed alias (e.g., `type CSSTokens map[string]string`) or narrowly scoped struct fields over `any`.

Examples

```go
// ✅ DO
func (s *AlbumsService) Update(ctx context.Context, id string, req api.AlbumUpdateRequest) error { /* ... */ }

// ❌ DON'T
func (s *AlbumsService) Update(ctx context.Context, id string, payload map[string]any) error { /* ... */ }
```

```go
// ✅ DO
type GenerateJobPayload struct {
    Task       string `json:"task"`
    OriginalID string `json:"original_id"`
    ThemeID    string `json:"theme_id"`
    GeneratedID string `json:"generated_id"`
}

// ❌ DON'T
payload := map[string]any{"task": "generate", "original_id": originalID}
```

